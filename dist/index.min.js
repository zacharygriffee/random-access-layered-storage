var t,e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i={};t||(t=1,function(t){"function"!=typeof t.setImmediate&&(t.setImmediate=function(t){"function"==typeof Promise?Promise.resolve().then(t):setTimeout(t,0)})}("undefined"==typeof self?void 0===e?i:e:self));var n={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var h=new s(n,r||t,o),a=i?i+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],h]:t._events[a].push(h):(t._events[a]=h,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function h(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),h.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},h.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},h.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},h.prototype.emit=function(t,e,n,s,r,o){var h=i?i+t:t;if(!this._events[h])return!1;var a,l,u=this._events[h],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,s),!0;case 5:return u.fn.call(u.context,e,n,s,r),!0;case 6:return u.fn.call(u.context,e,n,s,r,o),!0}for(l=1,a=new Array(c-1);l<c;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var f,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,n);break;case 4:u[l].fn.call(u[l].context,e,n,s);break;default:if(!a)for(f=1,a=new Array(c-1);f<c;f++)a[f-1]=arguments[f];u[l].fn.apply(u[l].context,a)}}return!0},h.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},h.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},h.prototype.removeListener=function(t,e,n,s){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var h=this._events[r];if(h.fn)h.fn!==e||s&&!h.once||n&&h.context!==n||o(this,r);else{for(var a=0,l=[],u=h.length;a<u;a++)(h[a].fn!==e||s&&!h[a].once||n&&h[a].context!==n)&&l.push(h[a]);l.length?this._events[r]=1===l.length?l[0]:l:o(this,r)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=i,h.EventEmitter=h,t.exports=h}(n);var s=n.exports;globalThis.EventEmitter=s;var r="function"==typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t);function o(){}function h(){h.init.call(this)}function a(t){return void 0===t._maxListeners?h.defaultMaxListeners:t._maxListeners}function l(t,e,i,n){var s,r,h,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((r=t._events)?(r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),h=r[e]):(r=t._events=new o,t._eventsCount=0),h){if("function"==typeof h?h=r[e]=n?[i,h]:[h,i]:n?h.unshift(i):h.push(i),!h.warned&&(s=a(t))&&s>0&&h.length>s){h.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=h.length,l=u,"function"==typeof console.warn?console.warn(l):console.log(l)}}else h=r[e]=i,++t._eventsCount;return t}function u(t,e,i){var n=!1;function s(){t.removeListener(e,s),n||(n=!0,i.apply(t,arguments))}return s.listener=i,s}function c(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function f(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}o.prototype=Object.create(null),h.EventEmitter=h,h.usingDomains=!1,h.prototype.domain=void 0,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.init=function(){this.domain=null,h.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new o,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},h.prototype.getMaxListeners=function(){return a(this)},h.prototype.emit=function(t){var e,i,n,s,r,o,h,a="error"===t;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(h=this.domain,a){if(e=arguments[1],!h){if(e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=h,e.domainThrown=!1,h.emit("error",e),!1}if(!(i=o[t]))return!1;var u="function"==typeof i;switch(n=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var n=t.length,s=f(t,n),r=0;r<n;++r)s[r].call(i)}(i,u,this);break;case 2:!function(t,e,i,n){if(e)t.call(i,n);else for(var s=t.length,r=f(t,s),o=0;o<s;++o)r[o].call(i,n)}(i,u,this,arguments[1]);break;case 3:!function(t,e,i,n,s){if(e)t.call(i,n,s);else for(var r=t.length,o=f(t,r),h=0;h<r;++h)o[h].call(i,n,s)}(i,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,n,s,r){if(e)t.call(i,n,s,r);else for(var o=t.length,h=f(t,o),a=0;a<o;++a)h[a].call(i,n,s,r)}(i,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(n-1),r=1;r<n;r++)s[r-1]=arguments[r];!function(t,e,i,n){if(e)t.apply(i,n);else for(var s=t.length,r=f(t,s),o=0;o<s;++o)r[o].apply(i,n)}(i,u,this,s)}return!0},h.prototype.addListener=function(t,e){return l(this,t,e,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(t,e){return l(this,t,e,!0)},h.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u(this,t,e)),this},h.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u(this,t,e)),this},h.prototype.removeListener=function(t,e){var i,n,s,r,h;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new o:(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,r=i.length;r-- >0;)if(i[r]===e||i[r].listener&&i[r].listener===e){h=i[r].listener,s=r;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new o,this;delete n[t]}else!function(t,e){for(var i=e,n=i+1,s=t.length;n<s;i+=1,n+=1)t[i]=t[n];t.pop()}(i,s);n.removeListener&&this.emit("removeListener",t,h||e)}return this},h.prototype.off=function(t,e){return this.removeListener(t,e)},h.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new o,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new o:delete i[t]),this;if(0===arguments.length){for(var n,s=Object.keys(i),r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new o,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},h.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},h.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):c.call(t,e)},h.prototype.listenerCount=c,h.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const d=function(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(Object.freeze({__proto__:null,default:h,EventEmitter:h})),g=r,p=E(new Error("Not readable")),_=E(new Error("Not writable")),y=E(new Error("Not deletable")),b=E(new Error("Not statable")),w=E(null),v=E(null),m=E(null);var L=class t extends d{constructor(e){super(),this._queued=[],this._pending=0,this._needsOpen=!0,this.opened=!1,this.suspended=!1,this.closed=!1,this.unlinked=!1,this.writing=!1,e&&(e.open&&(this._open=e.open),e.read&&(this._read=e.read),e.write&&(this._write=e.write),e.del&&(this._del=e.del),e.truncate&&(this._truncate=e.truncate),e.stat&&(this._stat=e.stat),e.suspend&&(this._suspend=e.suspend),e.close&&(this._close=e.close),e.unlink&&(this._unlink=e.unlink)),this.readable=this._read!==t.prototype._read,this.writable=this._write!==t.prototype._write,this.deletable=this._del!==t.prototype._del,this.truncatable=this._truncate!==t.prototype._truncate||this.deletable,this.statable=this._stat!==t.prototype._stat}read(t,e,i){this.run(new S(this,0,t,e,null,i),!1)}_read(t){return p(t)}write(t,e,i){i||(i=A),this.run(new S(this,1,t,e.length,e,i),!0)}_write(t){return _(t)}del(t,e,i){i||(i=A),this.run(new S(this,2,t,e,null,i),!0)}_del(t){return y(t)}truncate(t,e){e||(e=A),this.run(new S(this,3,t,0,null,e),!0)}_truncate(t){t.size=1/0,this._del(t)}stat(t){this.run(new S(this,4,0,0,null,t),!1)}_stat(t){return b(t)}open(t){if(t||(t=A),this.opened&&!this._needsOpen)return x(t);this._needsOpen=!1,z(this,new S(this,5,0,0,null,t))}_open(t){return w(t)}suspend(t){if(t||(t=A),this.closed||this.suspended)return x(t);this._needsOpen=!0,z(this,new S(this,6,0,0,null,t))}_suspend(t){this._close(t)}close(t){if(t||(t=A),this.closed)return x(t);z(this,new S(this,7,0,0,null,t))}_close(t){return v(t)}unlink(t){t||(t=A),this.closed||this.close(A),z(this,new S(this,8,0,0,null,t))}_unlink(t){return m(t)}run(t,e){e&&!this.writing&&(this.writing=!0,this._needsOpen=!0),this._needsOpen&&this.open(A),this._queued.length?this._queued.push(t):t._run()}};let S=class{constructor(t,e,i,n,s,r){this.type=e,this.offset=i,this.size=n,this.data=s,this.storage=t,this._sync=!1,this._callback=r,this._openError=null}_maybeOpenError(t){if(5!==this.type)return;const e=this.storage._queued;for(let i=1;i<e.length;i++){const n=e[i];if(5===n.type)break;n._openError=t}}_unqueue(t){const e=this.storage,i=e._queued;if(t)this._maybeOpenError(t);else if(this.type>4)switch(this.type){case 5:e.suspended&&(e.suspended=!1,e.emit("unsuspend")),e.opened||(e.opened=!0,e.emit("open"));break;case 6:e.suspended||(e.suspended=!0,e.emit("suspend"));break;case 7:e.closed||(e.closed=!0,e.emit("close"));break;case 8:e.unlinked||(e.unlinked=!0,e.emit("unlink"))}i.length&&i[0]===this&&i.shift(),--e._pending||function(t){const e=t._queued;for(;e.length>0;){const i=e[0].type>4;if(i&&t._pending||e[0]._run(),i)return;e.shift()}}(e)}callback(t,e){if(this._sync)return O(this,t,e);this._unqueue(t),this._callback(t,e)}_openAndNotClosed(){const t=this.storage;return!(!t.opened||t.closed||t.suspended)||(!t.opened||t.suspended?O(this,this._openError||new Error("Not opened")):t.closed&&O(this,new Error("Closed")),!1)}_open(){const t=this.storage;return t.opened&&!t.suspended?O(this,null):t.closed?O(this,new Error("Closed")):void t._open(this)}_run(){const t=this.storage;switch(t._pending++,this._sync=!0,this.type){case 0:this._openAndNotClosed()&&t._read(this);break;case 1:this._openAndNotClosed()&&t._write(this);break;case 2:this._openAndNotClosed()&&t._del(this);break;case 3:this._openAndNotClosed()&&t._truncate(this);break;case 4:this._openAndNotClosed()&&t._stat(this);break;case 5:this._open();break;case 6:t.closed||!t.opened||t.suspended?O(this,null):t._suspend(this);break;case 7:t.closed||!t.opened||t.suspended?O(this,null):t._close(this);break;case 8:t.unlinked?O(this,null):t._unlink(this)}this._sync=!1}};function z(t,e){t._queued.push(e),t._pending||e._run()}function E(t){return function(e){O(e,t)}}function O(t,e,i){g((()=>t.callback(e,i)))}function x(t){g((()=>t(null)))}function A(){}var k={exports:{}};function C(t){return t.length}var T={byteLength:C,toString:function(t){const e=t.byteLength;let i="";for(let n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i},write:function(t,e,i=0,n=C(e)){const s=Math.min(n,t.byteLength-i);for(let n=0;n<s;n++)t[i+n]=e.charCodeAt(n);return s}};const F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=new Uint8Array(256);for(let t=0;t<64;t++)D[F.charCodeAt(t)]=t;function M(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}D[45]=62,D[95]=63;var U={byteLength:M,toString:function(t){const e=t.byteLength;let i="";for(let n=0;n<e;n+=3)i+=F[t[n]>>2]+F[(3&t[n])<<4|t[n+1]>>4]+F[(15&t[n+1])<<2|t[n+2]>>6]+F[63&t[n+2]];return e%3==2?i=i.substring(0,i.length-1)+"=":e%3==1&&(i=i.substring(0,i.length-2)+"=="),i},write:function(t,e,i=0,n=M(e)){const s=Math.min(n,t.byteLength-i);for(let i=0,n=0;n<s;i+=4){const s=D[e.charCodeAt(i)],r=D[e.charCodeAt(i+1)],o=D[e.charCodeAt(i+2)],h=D[e.charCodeAt(i+3)];t[n++]=s<<2|r>>4,t[n++]=(15&r)<<4|o>>2,t[n++]=(3&o)<<6|63&h}return s}};function P(t){return t.length>>>1}var R={byteLength:P,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let i="",n=0;for(let s=e-e%4;n<s;n+=4)i+=t.getUint32(n).toString(16).padStart(8,"0");for(;n<e;n++)i+=t.getUint8(n).toString(16).padStart(2,"0");return i},write:function(t,e,i=0,n=P(e)){const s=Math.min(n,t.byteLength-i);for(let n=0;n<s;n++){const s=I(e.charCodeAt(2*n)),r=I(e.charCodeAt(2*n+1));if(void 0===s||void 0===r)return t.subarray(0,n);t[i+n]=s<<4|r}return s}};function I(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function W(t){let e=0;for(let i=0,n=t.length;i<n;i++){const s=t.charCodeAt(i);if(s>=55296&&s<=56319&&i+1<n){const n=t.charCodeAt(i+1);if(n>=56320&&n<=57343){e+=4,i++;continue}}e+=s<=127?1:s<=2047?2:3}return e}let N,j;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;N=function(e){return t.decode(e)}}else N=function(t){const e=t.byteLength;let i="",n=0;for(;n<e;){let s=t[n];if(s<=127){i+=String.fromCharCode(s),n++;continue}let r=0,o=0;if(s<=223?(r=1,o=31&s):s<=239?(r=2,o=15&s):s<=244&&(r=3,o=7&s),e-n-r>0){let e=0;for(;e<r;)s=t[n+e+1],o=o<<6|63&s,e+=1}else o=65533,r=e-n;i+=String.fromCodePoint(o),n+=r+1}return i};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;j=function(e,i,n=0,s=W(i)){const r=Math.min(s,e.byteLength-n);return t.encodeInto(i,e.subarray(n,n+r)),r}}else j=function(t,e,i=0,n=W(e)){const s=Math.min(n,t.byteLength-i);t=t.subarray(i,i+s);let r=0,o=0;for(;r<e.length;){const i=e.codePointAt(r);if(i<=127){t[o++]=i,r++;continue}let n=0,s=0;for(i<=2047?(n=6,s=192):i<=65535?(n=12,s=224):i<=2097151&&(n=18,s=240),t[o++]=s|i>>n,n-=6;n>=0;)t[o++]=128|i>>n&63,n-=6;r+=i>=65536?2:1}return s};var G={byteLength:W,toString:N,write:j};function B(t){return 2*t.length}var V={byteLength:B,toString:function(t){const e=t.byteLength;let i="";for(let n=0;n<e-1;n+=2)i+=String.fromCharCode(t[n]+256*t[n+1]);return i},write:function(t,e,i=0,n=B(e)){const s=Math.min(n,t.byteLength-i);let r=s;for(let n=0;n<e.length&&!((r-=2)<0);++n){const s=e.charCodeAt(n),r=s>>8,o=s%256;t[i+2*n]=o,t[i+2*n+1]=r}return s}};!function(t,e){const i=T,n=U,s=R,r=G,o=V,h=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function a(t){switch(t){case"ascii":return i;case"base64":return n;case"hex":return s;case"utf8":case"utf-8":case void 0:case null:return r;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o;default:throw new Error(`Unknown encoding: ${t}`)}}function l(t){return t instanceof Uint8Array}function u(t,e,i){return"string"==typeof t?function(t,e){const i=a(e),n=new Uint8Array(i.byteLength(t));return i.write(n,t,0,n.byteLength),n}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,i){return new Uint8Array(t,e,i)}(t,e,i)}function c(t,e,i,n,s){if(0===t.byteLength)return-1;if("string"==typeof i?(n=i,i=0):void 0===i?i=s?0:t.length-1:i<0&&(i+=t.byteLength),i>=t.byteLength){if(s)return-1;i=t.byteLength-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof e)e=u(e,n);else if("number"==typeof e)return e&=255,s?t.indexOf(e,i):t.lastIndexOf(e,i);if(0===e.byteLength)return-1;if(s){let n=-1;for(let s=i;s<t.byteLength;s++)if(t[s]===e[-1===n?0:s-n]){if(-1===n&&(n=s),s-n+1===e.byteLength)return n}else-1!==n&&(s-=s-n),n=-1}else{i+e.byteLength>t.byteLength&&(i=t.byteLength-e.byteLength);for(let n=i;n>=0;n--){let i=!0;for(let s=0;s<e.byteLength;s++)if(t[n+s]!==e[s]){i=!1;break}if(i)return n}}return-1}function f(t,e,i,n){return c(t,e,i,n,!0)}function d(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}t.exports=e={isBuffer:l,isEncoding:function(t){try{return a(t),!0}catch{return!1}},alloc:function(t,i,n){const s=new Uint8Array(t);return void 0!==i&&e.fill(s,i,0,s.byteLength,n),s},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return a(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const i=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=0;for(let s=i-i%4;n<s&&t.getUint32(n,h)===e.getUint32(n,h);n+=4);for(;n<i;n++){const i=t.getUint8(n),s=e.getUint8(n);if(i<s)return-1;if(i>s)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const i=new Uint8Array(e);let n=0;for(const e of t){if(n+e.byteLength>i.byteLength){const t=e.subarray(0,i.byteLength-n);return i.set(t,n),i}i.set(e,n),n+=e.byteLength}return i},copy:function(t,e,i=0,n=0,s=t.byteLength){if(s>0&&s<n)return 0;if(s===n)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(i<0)throw new RangeError("targetStart is out of range");if(n<0||n>=t.byteLength)throw new RangeError("sourceStart is out of range");if(s<0)throw new RangeError("sourceEnd is out of range");i>=e.byteLength&&(i=e.byteLength),s>t.byteLength&&(s=t.byteLength),e.byteLength-i<s-n&&(s=e.length-i+n);const r=s-n;return t===e?e.copyWithin(i,n,s):e.set(t.subarray(n,s),i),r},equals:function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;const i=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=0;for(let s=i-i%4;n<s;n+=4)if(t.getUint32(n,h)!==e.getUint32(n,h))return!1;for(;n<i;n++)if(t.getUint8(n)!==e.getUint8(n))return!1;return!0},fill:function(t,e,i,n,s){if("string"==typeof e?"string"==typeof i?(s=i,i=0,n=t.byteLength):"string"==typeof n&&(s=n,n=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),i<0||t.byteLength<i||t.byteLength<n)throw new RangeError("Out of range index");if(void 0===i&&(i=0),void 0===n&&(n=t.byteLength),n<=i)return t;if(e||(e=0),"number"==typeof e)for(let s=i;s<n;++s)t[s]=e;else{const r=(e=l(e)?e:u(e,s)).byteLength;for(let s=0;s<n-i;++s)t[s+i]=e[s%r]}return t},from:u,includes:function(t,e,i,n){return-1!==f(t,e,i,n)},indexOf:f,lastIndexOf:function(t,e,i,n){return c(t,e,i,n,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<e;i+=2)d(t,i,i+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<e;i+=4)d(t,i,i+3),d(t,i+1,i+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<e;i+=8)d(t,i,i+7),d(t,i+1,i+6),d(t,i+2,i+5),d(t,i+3,i+4);return t},toBuffer:function(t){return t},toString:function(t,e,i=0,n=t.byteLength){const s=t.byteLength;return i>=s||n<=i?"":(i<0&&(i=0),n>s&&(n=s),(0!==i||n<s)&&(t=t.subarray(i,n)),a(e).toString(t))},write:function(t,e,i,n,s){return void 0===i?s="utf8":void 0===n&&"string"==typeof i?(s=i,i=void 0):void 0===s&&"string"==typeof n&&(s=n,n=void 0),a(s).write(t,e,i,n)},writeDoubleLE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(i,e,!0),i+8},writeFloatLE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(i,e,!0),i+4},writeUInt32LE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(i,e,!0),i+4},writeInt32LE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(i,e,!0),i+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)},writeDoubleBE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(i,e,!1),i+8},writeFloatBE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(i,e,!1),i+4},writeUInt32BE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(i,e,!1),i+4},writeInt32BE:function(t,e,i){return void 0===i&&(i=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(i,e,!1),i+4},readDoubleBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!1)},readFloatBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!1)},readUInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!1)},readInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!1)}}}(k,k.exports);var q=k.exports,H="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function $(){throw new Error("setTimeout has not been defined")}function K(){throw new Error("clearTimeout has not been defined")}var X=$,Y=K;function J(t){if(X===setTimeout)return setTimeout(t,0);if((X===$||!X)&&setTimeout)return X=setTimeout,setTimeout(t,0);try{return X(t,0)}catch(e){try{return X.call(null,t,0)}catch(e){return X.call(this,t,0)}}}"function"==typeof H.setTimeout&&(X=setTimeout),"function"==typeof H.clearTimeout&&(Y=clearTimeout);var Q,Z=[],tt=!1,et=-1;function it(){tt&&Q&&(tt=!1,Q.length?Z=Q.concat(Z):et=-1,Z.length&&nt())}function nt(){if(!tt){var t=J(it);tt=!0;for(var e=Z.length;e;){for(Q=Z,Z=[];++et<e;)Q&&Q[et].run();et=-1,e=Z.length}Q=null,tt=!1,function(t){if(Y===clearTimeout)return clearTimeout(t);if((Y===K||!Y)&&clearTimeout)return Y=clearTimeout,clearTimeout(t);try{return Y(t)}catch(e){try{return Y.call(null,t)}catch(e){return Y.call(this,t)}}}(t)}}function st(t,e){this.fun=t,this.array=e}function rt(){}st.prototype.run=function(){this.fun.apply(null,this.array)};var ot=rt,ht=rt,at=rt,lt=rt,ut=rt,ct=rt,ft=rt,dt=H.performance||{},gt=dt.now||dt.mozNow||dt.msNow||dt.oNow||dt.webkitNow||function(){return(new Date).getTime()},pt=new Date,_t={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];Z.push(new st(t,e)),1!==Z.length||tt||J(nt)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:ot,addListener:ht,once:at,off:lt,removeListener:ut,removeAllListeners:ct,emit:ft,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*gt.call(dt),i=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(i-=t[0],(n-=t[1])<0&&(i--,n+=1e9)),[i,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-pt)/1e3}};const yt="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,bt=new Set,wt=_t||{},vt=(t,e,i,n)=>{"function"==typeof wt.emitWarning?wt.emitWarning(t,e,i,n):console.error(`[${i}] ${e}: ${t}`)};let mt=globalThis.AbortController,Lt=globalThis.AbortSignal;if(void 0===mt){Lt=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,e){this._onabort.push(e)}},mt=class{constructor(){e()}signal=new Lt;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);this.signal.onabort?.(t)}}};let t="1"!==wt.env?.LRU_CACHE_IGNORE_AC_WARNING;const e=()=>{t&&(t=!1,vt("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const St=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),zt=t=>St(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Et:null:null;class Et extends Array{constructor(t){super(t),this.fill(0)}}class Ot{heap;length;static#t=!1;static create(t){const e=zt(t);if(!e)return[];Ot.#t=!0;const i=new Ot(t,e);return Ot.#t=!1,i}constructor(t,e){if(!Ot.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class xt{#e;#i;#n;#s;#r;#o;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#h;#a;#l;#u;#c;#f;#d;#g;#p;#_;#y;#b;#w;#v;#m;#L;#S;static unsafeExposeInternals(t){return{starts:t.#w,ttls:t.#v,sizes:t.#b,keyMap:t.#l,keyList:t.#u,valList:t.#c,next:t.#f,prev:t.#d,get head(){return t.#g},get tail(){return t.#p},free:t.#_,isBackgroundFetch:e=>t.#z(e),backgroundFetch:(e,i,n,s)=>t.#E(e,i,n,s),moveToTail:e=>t.#O(e),indexes:e=>t.#x(e),rindexes:e=>t.#A(e),isStale:e=>t.#k(e)}}get max(){return this.#e}get maxSize(){return this.#i}get calculatedSize(){return this.#a}get size(){return this.#h}get fetchMethod(){return this.#r}get memoMethod(){return this.#o}get dispose(){return this.#n}get disposeAfter(){return this.#s}constructor(t){const{max:e=0,ttl:i,ttlResolution:n=1,ttlAutopurge:s,updateAgeOnGet:r,updateAgeOnHas:o,allowStale:h,dispose:a,disposeAfter:l,noDisposeOnSet:u,noUpdateTTL:c,maxSize:f=0,maxEntrySize:d=0,sizeCalculation:g,fetchMethod:p,memoMethod:_,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:b,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:v,ignoreFetchAbort:m}=t;if(0!==e&&!St(e))throw new TypeError("max option must be a nonnegative integer");const L=e?zt(e):Array;if(!L)throw new Error("invalid max value: "+e);if(this.#e=e,this.#i=f,this.maxEntrySize=d||this.#i,this.sizeCalculation=g,this.sizeCalculation){if(!this.#i&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==_&&"function"!=typeof _)throw new TypeError("memoMethod must be a function if defined");if(this.#o=_,void 0!==p&&"function"!=typeof p)throw new TypeError("fetchMethod must be a function if specified");if(this.#r=p,this.#L=!!p,this.#l=new Map,this.#u=new Array(e).fill(void 0),this.#c=new Array(e).fill(void 0),this.#f=new L(e),this.#d=new L(e),this.#g=0,this.#p=0,this.#_=Ot.create(e),this.#h=0,this.#a=0,"function"==typeof a&&(this.#n=a),"function"==typeof l?(this.#s=l,this.#y=[]):(this.#s=void 0,this.#y=void 0),this.#m=!!this.#n,this.#S=!!this.#s,this.noDisposeOnSet=!!u,this.noUpdateTTL=!!c,this.noDeleteOnFetchRejection=!!y,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!m,0!==this.maxEntrySize){if(0!==this.#i&&!St(this.#i))throw new TypeError("maxSize must be a positive integer if specified");if(!St(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#C()}if(this.allowStale=!!h,this.noDeleteOnStaleGet=!!b,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!o,this.ttlResolution=St(n)||0===n?n:1,this.ttlAutopurge=!!s,this.ttl=i||0,this.ttl){if(!St(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#T()}if(0===this.#e&&0===this.ttl&&0===this.#i)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#i){const t="LRU_CACHE_UNBOUNDED";(t=>!bt.has(t))(t)&&(bt.add(t),vt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,xt))}}getRemainingTTL(t){return this.#l.has(t)?1/0:0}#T(){const t=new Et(this.#e),e=new Et(this.#e);this.#v=t,this.#w=e,this.#F=(i,n,s=yt.now())=>{if(e[i]=0!==n?s:0,t[i]=n,0!==n&&this.ttlAutopurge){const t=setTimeout((()=>{this.#k(i)&&this.#D(this.#u[i],"expire")}),n+1);t.unref&&t.unref()}},this.#M=i=>{e[i]=0!==t[i]?yt.now():0},this.#U=(s,r)=>{if(t[r]){const o=t[r],h=e[r];if(!o||!h)return;s.ttl=o,s.start=h,s.now=i||n();const a=s.now-h;s.remainingTTL=o-a}};let i=0;const n=()=>{const t=yt.now();if(this.ttlResolution>0){i=t;const e=setTimeout((()=>i=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const r=this.#l.get(s);if(void 0===r)return 0;const o=t[r],h=e[r];return o&&h?o-((i||n())-h):1/0},this.#k=s=>{const r=e[s],o=t[s];return!!o&&!!r&&(i||n())-r>o}}#M=()=>{};#U=()=>{};#F=()=>{};#k=()=>!1;#C(){const t=new Et(this.#e);this.#a=0,this.#b=t,this.#P=e=>{this.#a-=t[e],t[e]=0},this.#R=(t,e,i,n)=>{if(this.#z(e))return 0;if(!St(i)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(i=n(e,t),!St(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return i},this.#I=(e,i,n)=>{if(t[e]=i,this.#i){const i=this.#i-t[e];for(;this.#a>i;)this.#W(!0)}this.#a+=t[e],n&&(n.entrySize=i,n.totalCalculatedSize=this.#a)}}#P=t=>{};#I=(t,e,i)=>{};#R=(t,e,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#x({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#p;this.#N(e)&&(!t&&this.#k(e)||(yield e),e!==this.#g);)e=this.#d[e]}*#A({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#g;this.#N(e)&&(!t&&this.#k(e)||(yield e),e!==this.#p);)e=this.#f[e]}#N(t){return void 0!==t&&this.#l.get(this.#u[t])===t}*entries(){for(const t of this.#x())void 0===this.#c[t]||void 0===this.#u[t]||this.#z(this.#c[t])||(yield[this.#u[t],this.#c[t]])}*rentries(){for(const t of this.#A())void 0===this.#c[t]||void 0===this.#u[t]||this.#z(this.#c[t])||(yield[this.#u[t],this.#c[t]])}*keys(){for(const t of this.#x()){const e=this.#u[t];void 0===e||this.#z(this.#c[t])||(yield e)}}*rkeys(){for(const t of this.#A()){const e=this.#u[t];void 0===e||this.#z(this.#c[t])||(yield e)}}*values(){for(const t of this.#x())void 0===this.#c[t]||this.#z(this.#c[t])||(yield this.#c[t])}*rvalues(){for(const t of this.#A())void 0===this.#c[t]||this.#z(this.#c[t])||(yield this.#c[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const i of this.#x()){const n=this.#c[i],s=this.#z(n)?n.__staleWhileFetching:n;if(void 0!==s&&t(s,this.#u[i],this))return this.get(this.#u[i],e)}}forEach(t,e=this){for(const i of this.#x()){const n=this.#c[i],s=this.#z(n)?n.__staleWhileFetching:n;void 0!==s&&t.call(e,s,this.#u[i],this)}}rforEach(t,e=this){for(const i of this.#A()){const n=this.#c[i],s=this.#z(n)?n.__staleWhileFetching:n;void 0!==s&&t.call(e,s,this.#u[i],this)}}purgeStale(){let t=!1;for(const e of this.#A({allowStale:!0}))this.#k(e)&&(this.#D(this.#u[e],"expire"),t=!0);return t}info(t){const e=this.#l.get(t);if(void 0===e)return;const i=this.#c[e],n=this.#z(i)?i.__staleWhileFetching:i;if(void 0===n)return;const s={value:n};if(this.#v&&this.#w){const t=this.#v[e],i=this.#w[e];if(t&&i){const e=t-(yt.now()-i);s.ttl=e,s.start=Date.now()}}return this.#b&&(s.size=this.#b[e]),s}dump(){const t=[];for(const e of this.#x({allowStale:!0})){const i=this.#u[e],n=this.#c[e],s=this.#z(n)?n.__staleWhileFetching:n;if(void 0===s||void 0===i)continue;const r={value:s};if(this.#v&&this.#w){r.ttl=this.#v[e];const t=yt.now()-this.#w[e];r.start=Math.floor(Date.now()-t)}this.#b&&(r.size=this.#b[e]),t.unshift([i,r])}return t}load(t){this.clear();for(const[e,i]of t){if(i.start){const t=Date.now()-i.start;i.start=yt.now()-t}this.set(e,i.value,i)}}set(t,e,i={}){if(void 0===e)return this.delete(t),this;const{ttl:n=this.ttl,start:s,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:h}=i;let{noUpdateTTL:a=this.noUpdateTTL}=i;const l=this.#R(t,e,i.size||0,o);if(this.maxEntrySize&&l>this.maxEntrySize)return h&&(h.set="miss",h.maxEntrySizeExceeded=!0),this.#D(t,"set"),this;let u=0===this.#h?void 0:this.#l.get(t);if(void 0===u)u=0===this.#h?this.#p:0!==this.#_.length?this.#_.pop():this.#h===this.#e?this.#W(!1):this.#h,this.#u[u]=t,this.#c[u]=e,this.#l.set(t,u),this.#f[this.#p]=u,this.#d[u]=this.#p,this.#p=u,this.#h++,this.#I(u,l,h),h&&(h.set="add"),a=!1;else{this.#O(u);const i=this.#c[u];if(e!==i){if(this.#L&&this.#z(i)){i.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=i;void 0===e||r||(this.#m&&this.#n?.(e,t,"set"),this.#S&&this.#y?.push([e,t,"set"]))}else r||(this.#m&&this.#n?.(i,t,"set"),this.#S&&this.#y?.push([i,t,"set"]));if(this.#P(u),this.#I(u,l,h),this.#c[u]=e,h){h.set="replace";const t=i&&this.#z(i)?i.__staleWhileFetching:i;void 0!==t&&(h.oldValue=t)}}else h&&(h.set="update")}if(0===n||this.#v||this.#T(),this.#v&&(a||this.#F(u,n,s),h&&this.#U(h,u)),!r&&this.#S&&this.#y){const t=this.#y;let e;for(;e=t?.shift();)this.#s?.(...e)}return this}pop(){try{for(;this.#h;){const t=this.#c[this.#g];if(this.#W(!0),this.#z(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(this.#S&&this.#y){const t=this.#y;let e;for(;e=t?.shift();)this.#s?.(...e)}}}#W(t){const e=this.#g,i=this.#u[e],n=this.#c[e];return this.#L&&this.#z(n)?n.__abortController.abort(new Error("evicted")):(this.#m||this.#S)&&(this.#m&&this.#n?.(n,i,"evict"),this.#S&&this.#y?.push([n,i,"evict"])),this.#P(e),t&&(this.#u[e]=void 0,this.#c[e]=void 0,this.#_.push(e)),1===this.#h?(this.#g=this.#p=0,this.#_.length=0):this.#g=this.#f[e],this.#l.delete(i),this.#h--,e}has(t,e={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=e,s=this.#l.get(t);if(void 0!==s){const t=this.#c[s];if(this.#z(t)&&void 0===t.__staleWhileFetching)return!1;if(!this.#k(s))return i&&this.#M(s),n&&(n.has="hit",this.#U(n,s)),!0;n&&(n.has="stale",this.#U(n,s))}else n&&(n.has="miss");return!1}peek(t,e={}){const{allowStale:i=this.allowStale}=e,n=this.#l.get(t);if(void 0===n||!i&&this.#k(n))return;const s=this.#c[n];return this.#z(s)?s.__staleWhileFetching:s}#E(t,e,i,n){const s=void 0===e?void 0:this.#c[e];if(this.#z(s))return s;const r=new mt,{signal:o}=i;o?.addEventListener("abort",(()=>r.abort(o.reason)),{signal:r.signal});const h={signal:r.signal,options:i,context:n},a=(n,s=!1)=>{const{aborted:o}=r.signal,a=i.ignoreFetchAbort&&void 0!==n;if(i.status&&(o&&!s?(i.status.fetchAborted=!0,i.status.fetchError=r.signal.reason,a&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),o&&!a&&!s)return l(r.signal.reason);const c=u;return this.#c[e]===u&&(void 0===n?c.__staleWhileFetching?this.#c[e]=c.__staleWhileFetching:this.#D(t,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(t,n,h.options))),n},l=n=>{const{aborted:s}=r.signal,o=s&&i.allowStaleOnFetchAbort,h=o||i.allowStaleOnFetchRejection,a=h||i.noDeleteOnFetchRejection,l=u;if(this.#c[e]===u&&(a&&void 0!==l.__staleWhileFetching?o||(this.#c[e]=l.__staleWhileFetching):this.#D(t,"fetch")),h)return i.status&&void 0!==l.__staleWhileFetching&&(i.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw n};i.status&&(i.status.fetchDispatched=!0);const u=new Promise(((e,n)=>{const o=this.#r?.(t,s,h);o&&o instanceof Promise&&o.then((t=>e(void 0===t?void 0:t)),n),r.signal.addEventListener("abort",(()=>{i.ignoreFetchAbort&&!i.allowStaleOnFetchAbort||(e(void 0),i.allowStaleOnFetchAbort&&(e=t=>a(t,!0)))}))})).then(a,(t=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=t),l(t)))),c=Object.assign(u,{__abortController:r,__staleWhileFetching:s,__returned:void 0});return void 0===e?(this.set(t,c,{...h.options,status:void 0}),e=this.#l.get(t)):this.#c[e]=c,c}#z(t){if(!this.#L)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof mt}async fetch(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:h=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:c=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:d=this.allowStaleOnFetchAbort,context:g,forceRefresh:p=!1,status:_,signal:y}=e;if(!this.#L)return _&&(_.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,status:_});const b={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,ttl:r,noDisposeOnSet:o,size:h,sizeCalculation:a,noUpdateTTL:l,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:c,allowStaleOnFetchAbort:d,ignoreFetchAbort:f,status:_,signal:y};let w=this.#l.get(t);if(void 0===w){_&&(_.fetch="miss");const e=this.#E(t,w,b,g);return e.__returned=e}{const e=this.#c[w];if(this.#z(e)){const t=i&&void 0!==e.__staleWhileFetching;return _&&(_.fetch="inflight",t&&(_.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const s=this.#k(w);if(!p&&!s)return _&&(_.fetch="hit"),this.#O(w),n&&this.#M(w),_&&this.#U(_,w),e;const r=this.#E(t,w,b,g),o=void 0!==r.__staleWhileFetching&&i;return _&&(_.fetch=s?"stale":"refresh",o&&s&&(_.returnedStale=!0)),o?r.__staleWhileFetching:r.__returned=r}}async forceFetch(t,e={}){const i=await this.fetch(t,e);if(void 0===i)throw new Error("fetch() returned undefined");return i}memo(t,e={}){const i=this.#o;if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:s,...r}=e,o=this.get(t,r);if(!s&&void 0!==o)return o;const h=i(t,o,{options:r,context:n});return this.set(t,h,r),h}get(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:r}=e,o=this.#l.get(t);if(void 0!==o){const e=this.#c[o],h=this.#z(e);return r&&this.#U(r,o),this.#k(o)?(r&&(r.get="stale"),h?(r&&i&&void 0!==e.__staleWhileFetching&&(r.returnedStale=!0),i?e.__staleWhileFetching:void 0):(s||this.#D(t,"expire"),r&&i&&(r.returnedStale=!0),i?e:void 0)):(r&&(r.get="hit"),h?e.__staleWhileFetching:(this.#O(o),n&&this.#M(o),e))}r&&(r.get="miss")}#j(t,e){this.#d[e]=t,this.#f[t]=e}#O(t){t!==this.#p&&(t===this.#g?this.#g=this.#f[t]:this.#j(this.#d[t],this.#f[t]),this.#j(this.#p,t),this.#p=t)}delete(t){return this.#D(t,"delete")}#D(t,e){let i=!1;if(0!==this.#h){const n=this.#l.get(t);if(void 0!==n)if(i=!0,1===this.#h)this.#G(e);else{this.#P(n);const i=this.#c[n];if(this.#z(i)?i.__abortController.abort(new Error("deleted")):(this.#m||this.#S)&&(this.#m&&this.#n?.(i,t,e),this.#S&&this.#y?.push([i,t,e])),this.#l.delete(t),this.#u[n]=void 0,this.#c[n]=void 0,n===this.#p)this.#p=this.#d[n];else if(n===this.#g)this.#g=this.#f[n];else{const t=this.#d[n];this.#f[t]=this.#f[n];const e=this.#f[n];this.#d[e]=this.#d[n]}this.#h--,this.#_.push(n)}}if(this.#S&&this.#y?.length){const t=this.#y;let e;for(;e=t?.shift();)this.#s?.(...e)}return i}clear(){return this.#G("delete")}#G(t){for(const e of this.#A({allowStale:!0})){const i=this.#c[e];if(this.#z(i))i.__abortController.abort(new Error("deleted"));else{const n=this.#u[e];this.#m&&this.#n?.(i,n,t),this.#S&&this.#y?.push([i,n,t])}}if(this.#l.clear(),this.#c.fill(void 0),this.#u.fill(void 0),this.#v&&this.#w&&(this.#v.fill(0),this.#w.fill(0)),this.#b&&this.#b.fill(0),this.#g=0,this.#p=0,this.#_.length=0,this.#a=0,this.#h=0,this.#S&&this.#y){const t=this.#y;let e;for(;e=t?.shift();)this.#s?.(...e)}}}class At extends L{constructor(t,e={}){super(e),this._underlying=t,this.pageSize=e.pageSize||1048576,this.maxPages=e.maxPages||100,this._createIfMissing=void 0===e.createIfMissing||e.createIfMissing,this._strictSizeLimit=e.strictSizeEnforcement,this._flushOnClose=void 0===e.flushOnClose||e.flushOnClose,this._autoFlushOnEvict=void 0===e.autoFlushOnEvict||e.autoFlushOnEvict,this._opts=e,t instanceof At&&(t._strictSizeLimit=this._strictSizeLimit),this._pages=new Map,this._lru=new xt({max:this.maxPages,dispose:this._onEvict.bind(this),noDisposeOnSet:!0}),this._pinnedPages=new Set,this._bitmask=null,this._size=0,this._fileExists=!1,this._accessTimes=new Map,this._modifiedPages=new Set,this.readable=!0,this.writable=!0,this.deletable=!0,this.truncatable=!0,this.statable=!0,this.destroyable=!0}get length(){return this._size}get size(){return this._size}_open(t){if(this.opened||this.opening)return t.callback(null);this.opening=!0;const e=e=>{this._fileExists=!0,"function"==typeof this._underlying.stat?this._underlying.stat(((e,i)=>{if(e)return this._size=0,this.opened=!0,this.opening=!1,t.callback(null,{size:0});this._size=Math.max(this._size,i.size),this.opened=!0,this.opening=!1,t.callback(null)})):(this.opened=!0,this.opening=!1,t.callback(null))};"function"==typeof this._underlying.open?this._underlying.open((i=>{if(i)return this.opening=!1,t.callback(i);e()})):e()}_read(t){this._ensureOpen((e=>{if(e)return t.callback(e);if(!this._fileExists)return t.callback(new Error("File does not exist"));if(void 0!==this._strictSizeLimit&&t.offset+t.size>this._strictSizeLimit)return t.callback(new Error("Read exceeds strict size enforcement"));const i=q.alloc(t.size,0);let n=0,s=t.offset;const r=()=>{if(n>=t.size)return t.callback(null,i);const e=Math.floor(s/this.pageSize),o=s%this.pageSize,h=Math.min(this.pageSize-o,t.size-n);this._getPage(e,((a,l)=>a&&a.message.includes("Read exceeds storage size")?(n+=h,s+=h,setImmediate(r)):a?t.callback(a):(i.set(l.data.subarray(o,o+h),n),this._touchPage(e),n+=h,s+=h,void setImmediate(r))))};r()}))}_write(t){console.log(`Write called on storage at offset ${t.offset}, size ${t.data.length}`),this._ensureOpen((e=>{if(e)return t.callback(e);if(void 0!==this._strictSizeLimit&&t.offset+t.data.length>this._strictSizeLimit)return t.callback(new Error("Write exceeds strict size enforcement"));let i=0,n=t.offset;const s=()=>{if(i>=t.data.length)return this._size=Math.max(this._size,t.offset+t.data.length),t.callback(null);const e=Math.floor(n/this.pageSize),r=n%this.pageSize,o=Math.min(this.pageSize-r,t.data.length-i);if(this._bitmask&&!this._isBitSet(n,o))return i+=o,n+=o,void setImmediate(s);this._getOrCreatePage(e,((h,a)=>{if(h)return t.callback(h);if(a.data.length<r+o){const t=q.alloc(r+o,0);q.copy(a.data,t),a.data=t}a.data.set(t.data.subarray(i,i+o),r),a.modified=!0,this._modifiedPages.add(e),this._pinnedPages.has(e)||this._touchPage(e),i+=o,n+=o,setImmediate(s)}))};s()}))}_del(t){this._ensureOpen((e=>{if(e)return t.callback(e);let i=0,n=t.offset;const s=t.size===1/0||t.offset+t.size>this._size?this._size:t.offset+t.size,r=()=>{if(i>=s-t.offset)return s===this._size&&(this._size=t.offset),t.callback(null);const e=Math.floor(n/this.pageSize),o=n%this.pageSize,h=Math.min(this.pageSize-o,s-n);this._getPage(e,((t,s)=>{s&&(q.fill(s.data,0,o,o+h),s.modified=!0,this._modifiedPages.add(e)),i+=h,n+=h,setImmediate(r)}))};r()}))}_truncate(t){this._ensureOpen((e=>{if(e)return t.callback(e);const i=t.offset;if(i>this._size){const e=i-this._size,n=q.alloc(e,0);this.write(this._size,n,(e=>{if(e)return t.callback(e);this._size=i,t.callback(null)}))}else{this._size=i;const e=Math.floor(i/this.pageSize),n=[...this._pages.keys()].filter((t=>t>e));for(const t of n)this._pages.delete(t),this._lru.delete(t),this._modifiedPages.delete(t),this._pinnedPages.delete(t);const s=this._pages.get(e);if(s){const t=i%this.pageSize;0===t?(this._pages.delete(e),this._lru.delete(e),this._modifiedPages.delete(e),this._pinnedPages.delete(e)):(s.data=s.data.subarray(0,t),s.modified=!0,this._modifiedPages.add(e))}this._supports("truncate")?this._underlying.truncate(i,(e=>{if(e)return t.callback(e);t.callback(null)})):t.callback(null)}}))}_stat(t){this._ensureOpen((e=>{if(e)return t.callback(e);t.callback(null,{size:this._size})}))}_close(t){const e=()=>{const e=()=>{this._supports("close")?this._underlying.close((e=>{if(e)return t.callback(e);this.closed=!0,t.callback(null)})):(this.closed=!0,t.callback(null))};this._flushOnClose?this.flush(0,this._size,(t=>{t&&console.error("Error during flush on close:",t),e()})):e()};this.opened?e():this._ensureOpen((i=>{if(i)return t.callback(i);e()}))}_unlink(t){this._ensureOpen((e=>{if(e)return t.callback(e);const i=()=>{this._supports("unlink")?this._underlying.unlink((e=>{if(e)return t.callback(e);this.unlinked=!0,t.callback(null)})):(this._pages.clear(),this._lru.clear(),this._modifiedPages.clear(),this._pinnedPages.clear(),this._size=0,this.unlinked=!0,t.callback(null))};this.opened?i():this._ensureOpen((e=>{if(e)return t.callback(e);i()}))}))}flush(t=0,e=this._size,i){"function"==typeof t&&(i=t,t=0),"function"==typeof e&&(i=e,e=this._size),this._ensureOpen((n=>{if(n)return i(n);e=Math.min(e,this._size),"function"==typeof this._underlying._ensureOpen?this._underlying._ensureOpen((n=>{if(n)return i(n);this._performFlush(t,e,i)})):this._performFlush(t,e,i)}))}_performFlush(t,e,i){const n=t+e,s=Math.floor(t/this.pageSize),r=Math.floor((n-1)/this.pageSize),o=[];for(let t=s;t<=r;t++)o.push(t);let h=0;const a=()=>{if(h>=o.length)return void(this._size<n&&this._supports("truncate")?this._underlying.truncate(this._size,(t=>{if(t)return i(t);i(null)})):i(null));const e=o[h++],l=e*this.pageSize,u=e===s?t%this.pageSize:0,c=e===r?(n-1)%this.pageSize+1:this.pageSize,f=c-u,d=this._pages.get(e),g=d?d.data.subarray(u,c):q.alloc(f,0);this._underlying.write(l+u,g,(t=>{if(t)return i(t);d&&d.modified&&(d.modified=!1,this._modifiedPages.delete(e)),setImmediate(a.bind(this))}))};a()}evict(t=1,e=!1,i=()=>{}){const n=this._lru.size,s=Math.ceil(n*t),r=[...this._lru.keys()].filter((t=>!this._pinnedPages.has(t))).reverse();let o=0;const h=()=>{if(o>=s||o>=r.length)return i(null);const t=r[o++];this._pages.get(t),e?this.flush(t*this.pageSize,this.pageSize,(e=>{e&&console.error(`Failed to flush page ${t} during eviction:`,e),this._evictPage(t),setImmediate(h)})):(this._evictPage(t),setImmediate(h))};h()}pin(t,e){const i=Math.floor(t/this.pageSize),n=Math.floor((t+e-1)/this.pageSize);for(let t=i;t<=n;t++)this._pinnedPages.add(t)}unpin(t,e){const i=Math.floor(t/this.pageSize),n=Math.floor((t+e-1)/this.pageSize);for(let t=i;t<=n;t++)this._pinnedPages.delete(t)}setBitmask(t){this._bitmask=t}clearBitmask(){this._bitmask=null}_isBitSet(t,e){if(!this._bitmask)return!0;for(let i=0;i<e;i++){const e=t+i,n=Math.floor(e/8),s=e%8;if(n>=this._bitmask.length)return!1;if(!(this._bitmask[n]>>s&1))return!1}return!0}_ensureOpen(t){if(this.opened)return t(null);this._underlying.open((e=>{if(e)return t(e);this._createIfMissing&&!this._fileExists?this._underlying.write(0,q.alloc(0),(e=>{if(e)return t(e);this._fileExists=!0,this._size=0,t(null)})):this._underlying.stat(((e,i)=>{e&&"ENOENT"===e.code?(this._fileExists=!1,this._size=0):e||(this._fileExists=!0,this._size=i.size||0),t(null)}))}))}_supports(t){return"function"==typeof this._underlying[t]}_getPage(t,e){let i=this._pages.get(t);if(i)return e(null,i);this._loadPage(t,e)}_getOrCreatePage(t,e){let i=this._pages.get(t);if(i)return e(null,i);this._loadOrCreatePage(t,e)}_loadPage(t,e){const i=t*this.pageSize,n={data:q.alloc(this.pageSize,0),modified:!1};if(this._fileExists&&this._supports("read")){const s=Math.min(this.pageSize,this._size-i);s>0?this._underlying.read(i,s,((i,r)=>{if(i)return e(i);n.data.set(r.subarray(0,s),0),this._pages.set(t,n),this._lru.set(t,!0),e(null,n)})):(this._pages.set(t,n),this._lru.set(t,!0),e(null,n))}else this._pages.set(t,n),this._lru.set(t,!0),e(null,n)}_loadOrCreatePage(t,e){this._loadPage(t,e)}_touchPage(t){this._accessTimes.set(t,Date.now()),this._lru.get(t)}_onEvict(t,e){const i=this._pages.get(t);if(i)return!this._pinnedPages.has(t)&&void(i.modified&&this._autoFlushOnEvict?this.flush(t*this.pageSize,this.pageSize,(e=>{e&&console.error(`Failed to flush page ${t} during eviction:`,e),this._evictPage(t)})):this._evictPage(t))}_evictPage(t){this._pinnedPages.has(t)||(this._pages.delete(t),this._lru.delete(t),this._modifiedPages.delete(t),this._accessTimes.delete(t))}}class kt extends At{constructor(t,e={}){super(t,e)}_read(t){this._ensureOpen((e=>e?t.callback(e):t.offset+t.size>this._size?t.callback(new Error("Attempted to read beyond the storage size.")):void super._read(t)))}}export{At as RandomAccessLayeredStorage,kt as StrictRandomAccessLayeredStorage};
