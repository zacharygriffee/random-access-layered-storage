/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/queue-tick@1.0.1/queue-microtask.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/random-access-storage@3.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function t(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(){}function s(){s.init.call(this);}function r(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function i(e,t,s,i){var o,u,l,h;if("function"!=typeof s)throw new TypeError('"listener" argument must be a function');if((u=e._events)?(u.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),u=e._events),l=u[t]):(u=e._events=new n,e._eventsCount=0),l){if("function"==typeof l?l=u[t]=i?[s,l]:[l,s]:i?l.unshift(s):l.push(s),!l.warned&&(o=r(e))&&o>0&&l.length>o){l.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=l.length,h=a,"function"==typeof console.warn?console.warn(h):console.log(h);}}else l=u[t]=s,++e._eventsCount;return e}function o(e,t,n){var s=!1;function r(){e.removeListener(t,r),s||(s=!0,n.apply(e,arguments));}return r.listener=n,r}function u(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function l(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}n.prototype=Object.create(null),s.EventEmitter=s,s.usingDomains=!1,s.prototype.domain=void 0,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.init=function(){this.domain=null,s.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return r(this)},s.prototype.emit=function(e){var t,n,s,r,i,o,u,h="error"===e;if(o=this._events)h=h&&null==o.error;else if(!h)return !1;if(u=this.domain,h){if(t=arguments[1],!u){if(t instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t),!1}if(!(n=o[e]))return !1;var c="function"==typeof n;switch(s=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var s=e.length,r=l(e,s),i=0;i<s;++i)r[i].call(n);}(n,c,this);break;case 2:!function(e,t,n,s){if(t)e.call(n,s);else for(var r=e.length,i=l(e,r),o=0;o<r;++o)i[o].call(n,s);}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,s,r){if(t)e.call(n,s,r);else for(var i=e.length,o=l(e,i),u=0;u<i;++u)o[u].call(n,s,r);}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,s,r,i){if(t)e.call(n,s,r,i);else for(var o=e.length,u=l(e,o),h=0;h<o;++h)u[h].call(n,s,r,i);}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(s-1),i=1;i<s;i++)r[i-1]=arguments[i];!function(e,t,n,s){if(t)e.apply(n,s);else for(var r=e.length,i=l(e,r),o=0;o<r;++o)i[o].apply(n,s);}(n,c,this,r);}return !0},s.prototype.addListener=function(e,t){return i(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return i(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,o(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,o(this,e,t)),this},s.prototype.removeListener=function(e,t){var s,r,i,o,u;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(s=r[e]))return this;if(s===t||s.listener&&s.listener===t)0==--this._eventsCount?this._events=new n:(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(i=-1,o=s.length;o-- >0;)if(s[o]===t||s[o].listener&&s[o].listener===t){u=s[o].listener,i=o;break}if(i<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new n,this;delete r[e];}else !function(e,t){for(var n=t,s=n+1,r=e.length;s<r;n+=1,s+=1)e[n]=e[s];e.pop();}(s,i);r.removeListener&&this.emit("removeListener",e,u||t);}return this},s.prototype.off=function(e,t){return this.removeListener(e,t)},s.prototype.removeAllListeners=function(e){var t,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new n,this._eventsCount=0):s[e]&&(0==--this._eventsCount?this._events=new n:delete s[e]),this;if(0===arguments.length){for(var r,i=Object.keys(s),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n,this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1]);}while(t[0]);return this},s.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},s.listenerCount=function(e,t){return "function"==typeof e.listenerCount?e.listenerCount(t):u.call(e,t)},s.prototype.listenerCount=u,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const h=t(Object.freeze({__proto__:null,default:s,EventEmitter:s})),a=e,c=b(new Error("Not readable")),p=b(new Error("Not writable")),d=b(new Error("Not deletable")),f=b(new Error("Not statable")),_=b(null),v=b(null),m=b(null);var y=class e extends h{constructor(t){super(),this._queued=[],this._pending=0,this._needsOpen=!0,this.opened=!1,this.suspended=!1,this.closed=!1,this.unlinked=!1,this.writing=!1,t&&(t.open&&(this._open=t.open),t.read&&(this._read=t.read),t.write&&(this._write=t.write),t.del&&(this._del=t.del),t.truncate&&(this._truncate=t.truncate),t.stat&&(this._stat=t.stat),t.suspend&&(this._suspend=t.suspend),t.close&&(this._close=t.close),t.unlink&&(this._unlink=t.unlink)),this.readable=this._read!==e.prototype._read,this.writable=this._write!==e.prototype._write,this.deletable=this._del!==e.prototype._del,this.truncatable=this._truncate!==e.prototype._truncate||this.deletable,this.statable=this._stat!==e.prototype._stat;}read(e,t,n){this.run(new w(this,0,e,t,null,n),!1);}_read(e){return c(e)}write(e,t,n){n||(n=E),this.run(new w(this,1,e,t.length,t,n),!0);}_write(e){return p(e)}del(e,t,n){n||(n=E),this.run(new w(this,2,e,t,null,n),!0);}_del(e){return d(e)}truncate(e,t){t||(t=E),this.run(new w(this,3,e,0,null,t),!0);}_truncate(e){e.size=1/0,this._del(e);}stat(e){this.run(new w(this,4,0,0,null,e),!1);}_stat(e){return f(e)}open(e){if(e||(e=E),this.opened&&!this._needsOpen)return L(e);this._needsOpen=!1,g(this,new w(this,5,0,0,null,e));}_open(e){return _(e)}suspend(e){if(e||(e=E),this.closed||this.suspended)return L(e);this._needsOpen=!0,g(this,new w(this,6,0,0,null,e));}_suspend(e){this._close(e);}close(e){if(e||(e=E),this.closed)return L(e);g(this,new w(this,7,0,0,null,e));}_close(e){return v(e)}unlink(e){e||(e=E),this.closed||this.close(E),g(this,new w(this,8,0,0,null,e));}_unlink(e){return m(e)}run(e,t){t&&!this.writing&&(this.writing=!0,this._needsOpen=!0),this._needsOpen&&this.open(E),this._queued.length?this._queued.push(e):e._run();}};class w{constructor(e,t,n,s,r,i){this.type=t,this.offset=n,this.size=s,this.data=r,this.storage=e,this._sync=!1,this._callback=i,this._openError=null;}_maybeOpenError(e){if(5!==this.type)return;const t=this.storage._queued;for(let n=1;n<t.length;n++){const s=t[n];if(5===s.type)break;s._openError=e;}}_unqueue(e){const t=this.storage,n=t._queued;if(e)this._maybeOpenError(e);else if(this.type>4)switch(this.type){case 5:t.suspended&&(t.suspended=!1,t.emit("unsuspend")),t.opened||(t.opened=!0,t.emit("open"));break;case 6:t.suspended||(t.suspended=!0,t.emit("suspend"));break;case 7:t.closed||(t.closed=!0,t.emit("close"));break;case 8:t.unlinked||(t.unlinked=!0,t.emit("unlink"));}n.length&&n[0]===this&&n.shift(),--t._pending||function(e){const t=e._queued;for(;t.length>0;){const n=t[0].type>4;if(n&&e._pending||t[0]._run(),n)return;t.shift();}}(t);}callback(e,t){if(this._sync)return k(this,e,t);this._unqueue(e),this._callback(e,t);}_openAndNotClosed(){const e=this.storage;return !(!e.opened||e.closed||e.suspended)||(!e.opened||e.suspended?k(this,this._openError||new Error("Not opened")):e.closed&&k(this,new Error("Closed")),!1)}_open(){const e=this.storage;return e.opened&&!e.suspended?k(this,null):e.closed?k(this,new Error("Closed")):void e._open(this)}_run(){const e=this.storage;switch(e._pending++,this._sync=!0,this.type){case 0:this._openAndNotClosed()&&e._read(this);break;case 1:this._openAndNotClosed()&&e._write(this);break;case 2:this._openAndNotClosed()&&e._del(this);break;case 3:this._openAndNotClosed()&&e._truncate(this);break;case 4:this._openAndNotClosed()&&e._stat(this);break;case 5:this._open();break;case 6:e.closed||!e.opened||e.suspended?k(this,null):e._suspend(this);break;case 7:e.closed||!e.opened||e.suspended?k(this,null):e._close(this);break;case 8:e.unlinked?k(this,null):e._unlink(this);}this._sync=!1;}}function g(e,t){e._queued.push(t),e._pending||t._run();}function b(e){return function(t){k(t,e);}}function k(e,t,n){a((()=>e.callback(t,n)));}function L(e){a((()=>e(null)));}function E(){}

export { y as RandomAccessStorage };
